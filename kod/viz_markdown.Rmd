---
title: "viz_markdown"
author: "Maria_Król"
date: "9 04 2020"
output: html_document
---

## Zmienna `t1.duda`

## Wizualizacja używając pakietu `geogrid`

```{r echo=FALSE}
library(geogrid)
library(sf)
library(tidyverse)
library(tmap)

prez = "https://raw.github.com/bananaonthemoon/wybory/master/dane/prez_woj.gpkg"
prez_woj = read_sf(prez, stringsAsFactors=FALSE) 
prez_woj$Nazwa4 <- substr(prez_woj$Nazwa, 1, 4)
```

### Na przykładzie województw
```{r}
# rawplot -----------------------------------------------------------------


rawplot_woj <- tm_shape(prez_woj) + 
  tm_polygons("t1.duda", palette = "viridis") +
  tm_text("Nazwa4")


# hexplot -----------------------------------------------------------------


par(mfrow = c(2, 3), mar = c(0, 0, 2, 0))
for (i in 1:6) {
  new_cells <- calculate_grid(shape = prez_woj, grid_type = "hexagonal", seed = i)
  plot(new_cells, main = paste("Seed", i, sep = " "))
}

new_cells_hex_woj <- calculate_grid(shape = prez_woj, grid_type = "hexagonal", seed = 2)
resulthex_woj <- assign_polygons(prez_woj, new_cells_hex_woj)

hexplot_woj <- tm_shape(resulthex_woj) + 
  tm_polygons("t1.duda", palette = "viridis") +
  tm_text("Nazwa4")


# regplot -----------------------------------------------------------------

par(mfrow = c(2, 3), mar = c(0, 0, 2, 0))
for (i in 1:6) {
  new_cells_woj <- calculate_grid(shape = prez_woj, grid_type = "regular", seed = i)
  plot(new_cells_woj, main = paste("Seed", i, sep = " "))
}

new_cells_reg_woj <- calculate_grid(shape = prez_woj, grid_type = "regular", seed = 2)
resultreg_woj <- assign_polygons(prez_woj, new_cells_reg_woj)

regplot_woj <- tm_shape(resultreg_woj) + 
  tm_polygons("t1.duda", palette = "viridis") +
  tm_text("Nazwa4")

tmap_arrange(rawplot_woj, hexplot_woj, regplot_woj, nrow = 3)


```

### Na przykładzie powiatów
```{r}

prez2 = "https://raw.github.com/bananaonthemoon/wybory/master/dane/prez_powiaty.gpkg"
prez_powiaty = read_sf(prez2, stringsAsFactors=FALSE) 
prez_powiaty$Nazwa4 <- substr(prez_powiaty$Nazwa, 1, 4)


# rawplot -----------------------------------------------------------------


rawplot <- tm_shape(prez_powiaty) + 
  tm_polygons("t1.duda", palette = "viridis") +
  tm_text("Nazwa4")


# hexplot -----------------------------------------------------------------


par(mfrow = c(2, 3), mar = c(0, 0, 2, 0))
for (i in 1:6) {
  new_cells <- calculate_grid(shape = prez_powiaty, grid_type = "hexagonal", seed = i)
  plot(new_cells, main = paste("Seed", i, sep = " "))
}

new_cells_hex <- calculate_grid(shape = prez_powiaty, grid_type = "hexagonal", seed = 2)
resulthex <- assign_polygons(prez_powiaty, new_cells_hex)

hexplot <- tm_shape(resulthex) + 
  tm_polygons("t1.duda", palette = "viridis") +
  tm_text("Nazwa4")


# regplot -----------------------------------------------------------------

par(mfrow = c(2, 3), mar = c(0, 0, 2, 0))
for (i in 1:6) {
  new_cells <- calculate_grid(shape = prez_powiaty, grid_type = "regular", seed = i)
  plot(new_cells, main = paste("Seed", i, sep = " "))
}

new_cells_reg <- calculate_grid(shape = prez_powiaty, grid_type = "regular", seed = 2)
resultreg <- assign_polygons(prez_powiaty, new_cells_reg)

regplot <- tm_shape(resultreg) + 
  tm_polygons("t1.duda", palette = "viridis") +
  tm_text("Nazwa4")

tmap_arrange(rawplot, hexplot, regplot, nrow = 3)


```

### Na przykładzie gmin
```{r}

prez2 = "https://raw.github.com/bananaonthemoon/wybory/master/dane/prez_gminy.gpkg"
prez_gminy = read_sf(prez2, stringsAsFactors=FALSE) 
prez_gminy$Nazwa4 <- substr(prez_gminy$Nazwa, 1, 4)


# rawplot -----------------------------------------------------------------


rawplot <- tm_shape(prez_gminy) + 
  tm_polygons("t1.duda", palette = "viridis") +
  tm_text("Nazwa4")


# hexplot -----------------------------------------------------------------


par(mfrow = c(2, 3), mar = c(0, 0, 2, 0))
for (i in 1:6) {
  new_cells <- calculate_grid(shape = prez_gminy, grid_type = "hexagonal", seed = i)
  plot(new_cells, main = paste("Seed", i, sep = " "))
}

new_cells_hex <- calculate_grid(shape = prez_gminy, grid_type = "hexagonal", seed = 2)
resulthex <- assign_polygons(prez_gminy, new_cells_hex)

hexplot <- tm_shape(resulthex) + 
  tm_polygons("t1.duda", palette = "viridis") +
  tm_text("Nazwa4")


# regplot -----------------------------------------------------------------

par(mfrow = c(2, 3), mar = c(0, 0, 2, 0))
for (i in 1:6) {
  new_cells <- calculate_grid(shape = prez_gminy, grid_type = "regular", seed = i)
  plot(new_cells, main = paste("Seed", i, sep = " "))
}

new_cells_reg <- calculate_grid(shape = prez_gminy, grid_type = "regular", seed = 2)
resultreg <- assign_polygons(prez_gminy, new_cells_reg)

regplot <- tm_shape(resultreg) + 
  tm_polygons("t1.duda", palette = "viridis") +
  tm_text("Nazwa4")

tmap_arrange(rawplot, hexplot, regplot, nrow = 3)


```


## Wizualizacja używając pakietu `cartogram`

### Na przykładzie województw
```{r}
library(cartogram)
library(tmap)
library(maptools)
library(tidyverse)
library(sf)

prez = "https://raw.github.com/bananaonthemoon/wybory/master/dane/prez_woj.gpkg"
prez_woj = read_sf(prez, stringsAsFactors=FALSE) %>%
  st_transform(crs = 2180)

# Continuous Area Cartogram
prez_woj_cont <- cartogram_cont(prez_woj, "t1.duda", 3)

# Non-contiguous Area Cartogram
prez_woj_ncont <- cartogram_ncont(prez_woj, "t1.duda")

# Non-overlapping Circles Cartogram
prez_woj_dorling <- cartogram_dorling(prez_woj, "t1.duda")

# Plots
m1 <- tm_shape(prez_woj_cont) + tm_polygons("t1.duda", style = "jenks", legend.show = FALSE) +
  tm_layout(frame = FALSE)

m2 <- tm_shape(prez_woj) + tm_borders() + 
  tm_shape(prez_woj_ncont) + tm_polygons("t1.duda", style = "jenks", legend.show = FALSE) +
  tm_layout(frame = FALSE)

m3 <- tm_shape(prez_woj) + tm_borders() + 
  tm_shape(prez_woj_dorling) + tm_polygons("t1.duda", style = "jenks", legend.show = FALSE) +
  tm_layout(frame = FALSE, legend.outside = TRUE)

ml <- tm_shape(prez_woj_dorling) + tm_polygons("t1.duda", style = "jenks") +
  tm_layout(frame = FALSE, legend.only = TRUE, legend.position = c("center", "center"))

tmap_arrange(m1, m2, m3, ml, nrow = 1)
```

### Na przykładzie powiatów
```{r}
library(cartogram)
library(tmap)
library(maptools)
library(tidyverse)
library(sf)

prez = "https://raw.github.com/bananaonthemoon/wybory/master/dane/prez_powiaty.gpkg"
prez_powiaty = read_sf(prez, stringsAsFactors=FALSE) %>%
  st_transform(crs = 2180)

# Continuous Area Cartogram
prez_powiaty_cont <- cartogram_cont(prez_powiaty, "t1.duda", 3)

# Non-contiguous Area Cartogram
prez_powiaty_ncont <- cartogram_ncont(prez_powiaty, "t1.duda")

# Non-overlapping Circles Cartogram
prez_powiaty_dorling <- cartogram_dorling(prez_powiaty, "t1.duda")

# Plots
m1 <- tm_shape(prez_powiaty_cont) + tm_polygons("t1.duda", style = "jenks", legend.show = FALSE) +
  tm_layout(frame = FALSE)

m2 <- tm_shape(prez_powiaty) + tm_borders() + 
  tm_shape(prez_powiaty_ncont) + tm_polygons("t1.duda", style = "jenks", legend.show = FALSE) +
  tm_layout(frame = FALSE)

m3 <- tm_shape(prez_powiaty) + tm_borders() + 
  tm_shape(prez_powiaty_dorling) + tm_polygons("t1.duda", style = "jenks", legend.show = FALSE) +
  tm_layout(frame = FALSE, legend.outside = TRUE)

ml <- tm_shape(prez_powiaty_dorling) + tm_polygons("t1.duda", style = "jenks") +
  tm_layout(frame = FALSE, legend.only = TRUE, legend.position = c("center", "center"))

tmap_arrange(m1, m2, m3, ml, nrow = 1)
```

### Na przykładzie gmin
```{r}
library(cartogram)
library(tmap)
library(maptools)
library(tidyverse)
library(sf)

prez = "https://raw.github.com/bananaonthemoon/wybory/master/dane/prez_gminy.gpkg"
prez_gminy = read_sf(prez, stringsAsFactors=FALSE) %>%
  st_transform(crs = 2180)

# Continuous Area Cartogram
prez_gminy_cont <- cartogram_cont(prez_gminy, "t1.duda", 3)

# Non-contiguous Area Cartogram
prez_gminy_ncont <- cartogram_ncont(prez_gminy, "t1.duda")

# Non-overlapping Circles Cartogram
prez_gminy_dorling <- cartogram_dorling(prez_gminy, "t1.duda")

# Plots
m1 <- tm_shape(prez_gminy_cont) + tm_polygons("t1.duda", style = "jenks", legend.show = FALSE) +
  tm_layout(frame = FALSE)

m2 <- tm_shape(prez_gminy) + tm_borders() + 
  tm_shape(prez_gminy_ncont) + tm_polygons("t1.duda", style = "jenks", legend.show = FALSE) +
  tm_layout(frame = FALSE)

m3 <- tm_shape(prez_gminy) + tm_borders() + 
  tm_shape(prez_gminy_dorling) + tm_polygons("t1.duda", style = "jenks", legend.show = FALSE) +
  tm_layout(frame = FALSE, legend.outside = TRUE)

ml <- tm_shape(prez_gminy_dorling) + tm_polygons("t1.duda", style = "jenks") +
  tm_layout(frame = FALSE, legend.only = TRUE, legend.position = c("center", "center"))

tmap_arrange(m1, m2, m3, ml, nrow = 1)
```
## Wizualizacja używając pakietu `linemap`

### Na przykładzie województw
```{r}
library(sf)
library(tidyverse)
library(linemap)

download.file("https://www.gis-support.pl/downloads/Wojewodztwa.zip", "Wojewodztwa.zip")
unzip("Wojewodztwa.zip")
granice = read_sf("Wojew˘dztwa.shp", stringsAsFactors=FALSE) %>%
  st_transform(crs = 2180) %>%
  st_combine() 

prez = "https://raw.github.com/bananaonthemoon/wybory/master/dane/prez_woj.gpkg"
prez_woj = read_sf(prez, stringsAsFactors=FALSE) 


# LINEMAP -----------------------------------------------------------------


grid = getgrid(x = prez_woj, cellsize = 4000, var = "t1.duda")


# wizualizacja 1 ------------------------------------------------------------


tlo = par(mar=c(0,0,0,0), bg = "ivory2")
plot(st_geometry(granice), col="ivory1", border = NA,
     xlim = c(min(grid$X), max(grid$X)), ylim= c(min(grid$Y), max(grid$Y)))
linemap(x = grid, var = "t1.duda", k = 200, threshold = 0.00005,
        col = "ivory1", border = "ivory4", lwd = 0.6, add = TRUE)
par(tlo)


# wizualizacja 2 ------------------------------------------------------------

opar <- par(mar = c(0,0,0,0))
plot(st_geometry(granice), col="lightblue3", border = NA, bg = "lightblue2",
     xlim = c(min(grid$X), max(grid$X)), ylim= c(min(grid$Y), max(grid$Y)))
linemap(x = grid, var = "t1.duda", k = 5000, threshold = 0.000005,
        col = "lightblue3", border = "white", lwd = 0.6,
        add = TRUE)
par(opar)
```

### Na przykładzie powiatów
```{r}
library(sf)
library(tidyverse)
library(linemap)

download.file("https://www.gis-support.pl/downloads/Powiaty.zip", "Powiaty.zip")
unzip("Powiaty.zip")
granice = read_sf("Powiaty.shp", stringsAsFactors=FALSE) %>%
  st_transform(crs = 2180) %>%
  st_combine() 

prez = "https://raw.github.com/bananaonthemoon/wybory/master/dane/prez_powiaty.gpkg"
prez_powiaty = read_sf(prez, stringsAsFactors=FALSE) 


# LINEMAP -----------------------------------------------------------------


grid = getgrid(x = prez_powiaty, cellsize = 4000, var = "t1.duda")


# wizualizacja 1 ------------------------------------------------------------


tlo = par(mar=c(0,0,0,0), bg = "ivory2")
plot(st_geometry(granice), col="ivory1", border = NA,
     xlim = c(min(grid$X), max(grid$X)), ylim= c(min(grid$Y), max(grid$Y)))
linemap(x = grid, var = "t1.duda", k = 200, threshold = 0.00005,
        col = "ivory1", border = "ivory4", lwd = 0.6, add = TRUE)
par(tlo)


# wizualizacja 2 ------------------------------------------------------------

opar <- par(mar = c(0,0,0,0))
plot(st_geometry(granice), col="lightblue3", border = NA, bg = "lightblue2",
     xlim = c(min(grid$X), max(grid$X)), ylim= c(min(grid$Y), max(grid$Y)))
linemap(x = grid, var = "t1.duda", k = 5000, threshold = 0.000005,
        col = "lightblue3", border = "white", lwd = 0.6,
        add = TRUE)
par(opar)
```
### Na przykładzie gmin
```{r}
library(sf)
library(tidyverse)
library(linemap)

download.file("https://www.gis-support.pl/downloads/Gminy.zip", "Gminy.zip")
unzip("Gminy.zip")
granice = read_sf("Gminy.shp", stringsAsFactors=FALSE) %>%
  st_transform(crs = 2180) %>%
  st_combine() 

prez = "https://raw.github.com/bananaonthemoon/wybory/master/dane/prez_gminy.gpkg"
prez_gminy = read_sf(prez, stringsAsFactors=FALSE) 


# LINEMAP -----------------------------------------------------------------


grid = getgrid(x = prez_gminy, cellsize = 4000, var = "t1.duda")


# wizualizacja 1 ------------------------------------------------------------


tlo = par(mar=c(0,0,0,0), bg = "ivory2")
plot(st_geometry(granice), col="ivory1", border = NA,
     xlim = c(min(grid$X), max(grid$X)), ylim= c(min(grid$Y), max(grid$Y)))
linemap(x = grid, var = "t1.duda", k = 200, threshold = 0.00005,
        col = "ivory1", border = "ivory4", lwd = 0.6, add = TRUE)
par(tlo)


# wizualizacja 2 ------------------------------------------------------------

opar <- par(mar = c(0,0,0,0))
plot(st_geometry(granice), col="lightblue3", border = NA, bg = "lightblue2",
     xlim = c(min(grid$X), max(grid$X)), ylim= c(min(grid$Y), max(grid$Y)))
linemap(x = grid, var = "t1.duda", k = 5000, threshold = 0.000005,
        col = "lightblue3", border = "white", lwd = 0.6,
        add = TRUE)
par(opar)
```



## Zmienna `X2_frekw`


## Wizualizacja używając pakietu `geogrid`

### Na przykładzie województw
```{r}
library(geogrid)
library(sf)
library(tidyverse)
library(tmap)

prez1 = "https://raw.github.com/bananaonthemoon/wybory/master/dane/prez_woj.gpkg"
prez_woj = read_sf(prez1, stringsAsFactors=FALSE) 
prez_woj$Nazwa4 <- substr(prez_woj$Nazwa, 1, 4)


# rawplot -----------------------------------------------------------------


rawplot <- tm_shape(prez_woj) + 
  tm_polygons("X2_frekw", palette = "viridis") +
  tm_text("Nazwa4")


# hexplot -----------------------------------------------------------------


par(mfrow = c(2, 3), mar = c(0, 0, 2, 0))
for (i in 1:6) {
  new_cells <- calculate_grid(shape = prez_woj, grid_type = "hexagonal", seed = i)
  plot(new_cells, main = paste("Seed", i, sep = " "))
}

new_cells_hex <- calculate_grid(shape = prez_woj, grid_type = "hexagonal", seed = 2)
resulthex <- assign_polygons(prez_woj, new_cells_hex)

hexplot <- tm_shape(resulthex) + 
  tm_polygons("X2_frekw", palette = "viridis") +
  tm_text("Nazwa4")


# regplot -----------------------------------------------------------------

par(mfrow = c(2, 3), mar = c(0, 0, 2, 0))
for (i in 1:6) {
  new_cells <- calculate_grid(shape = prez_woj, grid_type = "regular", seed = i)
  plot(new_cells, main = paste("Seed", i, sep = " "))
}

new_cells_reg <- calculate_grid(shape = prez_woj, grid_type = "regular", seed = 2)
resultreg <- assign_polygons(prez_woj, new_cells_reg)

regplot <- tm_shape(resultreg) + 
  tm_polygons("X2_frekw", palette = "viridis") +
  tm_text("Nazwa4")

tmap_arrange(rawplot, hexplot, regplot, nrow = 3)


```

### Na przykładzie powiatów
```{r}

prez2 = "https://raw.github.com/bananaonthemoon/wybory/master/dane/prez_powiaty.gpkg"
prez_powiaty = read_sf(prez2, stringsAsFactors=FALSE) 
prez_powiaty$Nazwa4 <- substr(prez_powiaty$Nazwa, 1, 4)


# rawplot -----------------------------------------------------------------


rawplot <- tm_shape(prez_powiaty) + 
  tm_polygons("X2_frekw", palette = "viridis") +
  tm_text("Nazwa4")


# hexplot -----------------------------------------------------------------


par(mfrow = c(2, 3), mar = c(0, 0, 2, 0))
for (i in 1:6) {
  new_cells <- calculate_grid(shape = prez_powiaty, grid_type = "hexagonal", seed = i)
  plot(new_cells, main = paste("Seed", i, sep = " "))
}

new_cells_hex <- calculate_grid(shape = prez_powiaty, grid_type = "hexagonal", seed = 2)
resulthex <- assign_polygons(prez_powiaty, new_cells_hex)

hexplot <- tm_shape(resulthex) + 
  tm_polygons("X2_frekw", palette = "viridis") +
  tm_text("Nazwa4")


# regplot -----------------------------------------------------------------

par(mfrow = c(2, 3), mar = c(0, 0, 2, 0))
for (i in 1:6) {
  new_cells <- calculate_grid(shape = prez_powiaty, grid_type = "regular", seed = i)
  plot(new_cells, main = paste("Seed", i, sep = " "))
}

new_cells_reg <- calculate_grid(shape = prez_powiaty, grid_type = "regular", seed = 2)
resultreg <- assign_polygons(prez_powiaty, new_cells_reg)

regplot <- tm_shape(resultreg) + 
  tm_polygons("X2_frekw", palette = "viridis") +
  tm_text("Nazwa4")

tmap_arrange(rawplot, hexplot, regplot, nrow = 3)


```

### Na przykładzie gmin
```{r}

prez2 = "https://raw.github.com/bananaonthemoon/wybory/master/dane/prez_gminy.gpkg"
prez_gminy = read_sf(prez2, stringsAsFactors=FALSE) 
prez_gminy$Nazwa4 <- substr(prez_gminy$Nazwa, 1, 4)


# rawplot -----------------------------------------------------------------


rawplot <- tm_shape(prez_gminy) + 
  tm_polygons("X2_frekw", palette = "viridis") +
  tm_text("Nazwa4")


# hexplot -----------------------------------------------------------------


par(mfrow = c(2, 3), mar = c(0, 0, 2, 0))
for (i in 1:6) {
  new_cells <- calculate_grid(shape = prez_gminy, grid_type = "hexagonal", seed = i)
  plot(new_cells, main = paste("Seed", i, sep = " "))
}

new_cells_hex <- calculate_grid(shape = prez_gminy, grid_type = "hexagonal", seed = 2)
resulthex <- assign_polygons(prez_gminy, new_cells_hex)

hexplot <- tm_shape(resulthex) + 
  tm_polygons("X2_frekw", palette = "viridis") +
  tm_text("Nazwa4")


# regplot -----------------------------------------------------------------

par(mfrow = c(2, 3), mar = c(0, 0, 2, 0))
for (i in 1:6) {
  new_cells <- calculate_grid(shape = prez_gminy, grid_type = "regular", seed = i)
  plot(new_cells, main = paste("Seed", i, sep = " "))
}

new_cells_reg <- calculate_grid(shape = prez_gminy, grid_type = "regular", seed = 2)
resultreg <- assign_polygons(prez_gminy, new_cells_reg)

regplot <- tm_shape(resultreg) + 
  tm_polygons("X2_frekw", palette = "viridis") +
  tm_text("Nazwa4")

tmap_arrange(rawplot, hexplot, regplot, nrow = 3)


```


## Wizualizacja używając pakietu `cartogram`

### Na przykładzie województw
```{r}
library(cartogram)
library(tmap)
library(maptools)
library(tidyverse)
library(sf)

prez = "https://raw.github.com/bananaonthemoon/wybory/master/dane/prez_woj.gpkg"
prez_woj = read_sf(prez, stringsAsFactors=FALSE) %>%
  st_transform(crs = 2180)

# Continuous Area Cartogram
prez_woj_cont <- cartogram_cont(prez_woj, "X2_frekw", 3)

# Non-contiguous Area Cartogram
prez_woj_ncont <- cartogram_ncont(prez_woj, "X2_frekw")

# Non-overlapping Circles Cartogram
prez_woj_dorling <- cartogram_dorling(prez_woj, "X2_frekw")

# Plots
m1 <- tm_shape(prez_woj_cont) + tm_polygons("X2_frekw", style = "jenks", legend.show = FALSE) +
  tm_layout(frame = FALSE)

m2 <- tm_shape(prez_woj) + tm_borders() + 
  tm_shape(prez_woj_ncont) + tm_polygons("X2_frekw", style = "jenks", legend.show = FALSE) +
  tm_layout(frame = FALSE)

m3 <- tm_shape(prez_woj) + tm_borders() + 
  tm_shape(prez_woj_dorling) + tm_polygons("X2_frekw", style = "jenks", legend.show = FALSE) +
  tm_layout(frame = FALSE, legend.outside = TRUE)

ml <- tm_shape(prez_woj_dorling) + tm_polygons("X2_frekw", style = "jenks") +
  tm_layout(frame = FALSE, legend.only = TRUE, legend.position = c("center", "center"))

tmap_arrange(m1, m2, m3, ml, nrow = 1)
```

### Na przykładzie powiatów
```{r}
library(cartogram)
library(tmap)
library(maptools)
library(tidyverse)
library(sf)

prez = "https://raw.github.com/bananaonthemoon/wybory/master/dane/prez_powiaty.gpkg"
prez_powiaty = read_sf(prez, stringsAsFactors=FALSE) %>%
  st_transform(crs = 2180)

# Continuous Area Cartogram
prez_powiaty_cont <- cartogram_cont(prez_powiaty, "X2_frekw", 3)

# Non-contiguous Area Cartogram
prez_powiaty_ncont <- cartogram_ncont(prez_powiaty, "X2_frekw")

# Non-overlapping Circles Cartogram
prez_powiaty_dorling <- cartogram_dorling(prez_powiaty, "X2_frekw")

# Plots
m1 <- tm_shape(prez_powiaty_cont) + tm_polygons("X2_frekw", style = "jenks", legend.show = FALSE) +
  tm_layout(frame = FALSE)

m2 <- tm_shape(prez_powiaty) + tm_borders() + 
  tm_shape(prez_powiaty_ncont) + tm_polygons("X2_frekw", style = "jenks", legend.show = FALSE) +
  tm_layout(frame = FALSE)

m3 <- tm_shape(prez_powiaty) + tm_borders() + 
  tm_shape(prez_powiaty_dorling) + tm_polygons("X2_frekw", style = "jenks", legend.show = FALSE) +
  tm_layout(frame = FALSE, legend.outside = TRUE)

ml <- tm_shape(prez_powiaty_dorling) + tm_polygons("X2_frekw", style = "jenks") +
  tm_layout(frame = FALSE, legend.only = TRUE, legend.position = c("center", "center"))

tmap_arrange(m1, m2, m3, ml, nrow = 1)
```

### Na przykładzie gmin
```{r}
library(cartogram)
library(tmap)
library(maptools)
library(tidyverse)
library(sf)

prez = "https://raw.github.com/bananaonthemoon/wybory/master/dane/prez_gminy.gpkg"
prez_gminy = read_sf(prez, stringsAsFactors=FALSE) %>%
  st_transform(crs = 2180)

# Continuous Area Cartogram
prez_gminy_cont <- cartogram_cont(prez_gminy, "X2_frekw", 3)

# Non-contiguous Area Cartogram
prez_gminy_ncont <- cartogram_ncont(prez_gminy, "X2_frekw")

# Non-overlapping Circles Cartogram
prez_gminy_dorling <- cartogram_dorling(prez_gminy, "X2_frekw")

# Plots
m1 <- tm_shape(prez_gminy_cont) + tm_polygons("X2_frekw", style = "jenks", legend.show = FALSE) +
  tm_layout(frame = FALSE)

m2 <- tm_shape(prez_gminy) + tm_borders() + 
  tm_shape(prez_gminy_ncont) + tm_polygons("X2_frekw", style = "jenks", legend.show = FALSE) +
  tm_layout(frame = FALSE)

m3 <- tm_shape(prez_gminy) + tm_borders() + 
  tm_shape(prez_gminy_dorling) + tm_polygons("X2_frekw", style = "jenks", legend.show = FALSE) +
  tm_layout(frame = FALSE, legend.outside = TRUE)

ml <- tm_shape(prez_gminy_dorling) + tm_polygons("X2_frekw", style = "jenks") +
  tm_layout(frame = FALSE, legend.only = TRUE, legend.position = c("center", "center"))

tmap_arrange(m1, m2, m3, ml, nrow = 1)
```
## Wizualizacja używając pakietu `linemap`

### Na przykładzie województw
```{r}
library(sf)
library(tidyverse)
library(linemap)

download.file("https://www.gis-support.pl/downloads/Wojewodztwa.zip", "Wojewodztwa.zip")
unzip("Wojewodztwa.zip")
granice = read_sf("Wojew˘dztwa.shp", stringsAsFactors=FALSE) %>%
  st_transform(crs = 2180) %>%
  st_combine() 

prez = "https://raw.github.com/bananaonthemoon/wybory/master/dane/prez_woj.gpkg"
prez_woj = read_sf(prez, stringsAsFactors=FALSE) 


# LINEMAP -----------------------------------------------------------------


grid = getgrid(x = prez_woj, cellsize = 4000, var = "X2_frekw")


# wizualizacja 1 ------------------------------------------------------------


tlo = par(mar=c(0,0,0,0), bg = "ivory2")
plot(st_geometry(granice), col="ivory1", border = NA,
     xlim = c(min(grid$X), max(grid$X)), ylim= c(min(grid$Y), max(grid$Y)))
linemap(x = grid, var = "X2_frekw", k = 200, threshold = 0.00005,
        col = "ivory1", border = "ivory4", lwd = 0.6, add = TRUE)
par(tlo)


# wizualizacja 2 ------------------------------------------------------------

opar <- par(mar = c(0,0,0,0))
plot(st_geometry(granice), col="lightblue3", border = NA, bg = "lightblue2",
     xlim = c(min(grid$X), max(grid$X)), ylim= c(min(grid$Y), max(grid$Y)))
linemap(x = grid, var = "X2_frekw", k = 5000, threshold = 0.000005,
        col = "lightblue3", border = "white", lwd = 0.6,
        add = TRUE)
par(opar)
```

### Na przykładzie powiatów
```{r}
library(sf)
library(tidyverse)
library(linemap)

download.file("https://www.gis-support.pl/downloads/Powiaty.zip", "Powiaty.zip")
unzip("Powiaty.zip")
granice = read_sf("Powiaty.shp", stringsAsFactors=FALSE) %>%
  st_transform(crs = 2180) %>%
  st_combine() 

prez = "https://raw.github.com/bananaonthemoon/wybory/master/dane/prez_powiaty.gpkg"
prez_powiaty = read_sf(prez, stringsAsFactors=FALSE) 


# LINEMAP -----------------------------------------------------------------


grid = getgrid(x = prez_powiaty, cellsize = 4000, var = "X2_frekw")


# wizualizacja 1 ------------------------------------------------------------


tlo = par(mar=c(0,0,0,0), bg = "ivory2")
plot(st_geometry(granice), col="ivory1", border = NA,
     xlim = c(min(grid$X), max(grid$X)), ylim= c(min(grid$Y), max(grid$Y)))
linemap(x = grid, var = "X2_frekw", k = 200, threshold = 0.00005,
        col = "ivory1", border = "ivory4", lwd = 0.6, add = TRUE)
par(tlo)


# wizualizacja 2 ------------------------------------------------------------

opar <- par(mar = c(0,0,0,0))
plot(st_geometry(granice), col="lightblue3", border = NA, bg = "lightblue2",
     xlim = c(min(grid$X), max(grid$X)), ylim= c(min(grid$Y), max(grid$Y)))
linemap(x = grid, var = "X2_frekw", k = 5000, threshold = 0.000005,
        col = "lightblue3", border = "white", lwd = 0.6,
        add = TRUE)
par(opar)
```
### Na przykładzie gmin
```{r}
library(sf)
library(tidyverse)
library(linemap)

download.file("https://www.gis-support.pl/downloads/Gminy.zip", "Gminy.zip")
unzip("Gminy.zip")
granice = read_sf("Gminy.shp", stringsAsFactors=FALSE) %>%
  st_transform(crs = 2180) %>%
  st_combine() 

prez = "https://raw.github.com/bananaonthemoon/wybory/master/dane/prez_gminy.gpkg"
prez_gminy = read_sf(prez, stringsAsFactors=FALSE) 


# LINEMAP -----------------------------------------------------------------


grid = getgrid(x = prez_gminy, cellsize = 4000, var = "X2_frekw")


# wizualizacja 1 ------------------------------------------------------------


tlo = par(mar=c(0,0,0,0), bg = "ivory2")
plot(st_geometry(granice), col="ivory1", border = NA,
     xlim = c(min(grid$X), max(grid$X)), ylim= c(min(grid$Y), max(grid$Y)))
linemap(x = grid, var = "X2_frekw", k = 200, threshold = 0.00005,
        col = "ivory1", border = "ivory4", lwd = 0.6, add = TRUE)
par(tlo)


# wizualizacja 2 ------------------------------------------------------------

opar <- par(mar = c(0,0,0,0))
plot(st_geometry(granice), col="lightblue3", border = NA, bg = "lightblue2",
     xlim = c(min(grid$X), max(grid$X)), ylim= c(min(grid$Y), max(grid$Y)))
linemap(x = grid, var = "X2_frekw", k = 5000, threshold = 0.000005,
        col = "lightblue3", border = "white", lwd = 0.6,
        add = TRUE)
par(opar)
```